import{_ as E,m as T}from"./index-BhNpcME0.js";import{w as V,u as W,v as X,x as Y,y as Z,z as $,A as ee,B as te,C as I,D as L,a as m,h as v,b as o,t as N,i as U,E as M,G as B,d as ne,g as C,H as oe,j as k,o as u,k as _,I as P,J as ie,F as j,K as z,L as se}from"./vendor-BJuH5pbf.js";var re=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCommentChange","onCompositionEnd","onCompositionStart","onCompositionUpdate","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],le=function(t){return re.map(function(e){return e.toLowerCase()}).indexOf(t.toLowerCase())!==-1},ae=function(t,e,s){Object.keys(e).filter(le).forEach(function(a){var r=e[a];typeof r=="function"&&(a==="onInit"?r(t,s):s.on(a.substring(2),function(n){return r(n,s)}))})},de=function(t,e,s,a){var r=t.modelEvents?t.modelEvents:null,n=Array.isArray(r)?r.join(" "):r;V(a,function(d,i){s&&typeof d=="string"&&d!==i&&d!==s.getContent({format:t.outputFormat})&&s.setContent(d)}),s.on(n||"change input undo redo",function(){e.emit("update:modelValue",s.getContent({format:t.outputFormat}))})},ue=function(t,e,s,a,r,n){a.setContent(n()),s.attrs["onUpdate:modelValue"]&&de(e,s,a,r),ae(t,s.attrs,a)},O=0,K=function(t){var e=Date.now(),s=Math.floor(Math.random()*1e9);return O++,t+"_"+s+O+String(e)},ce=function(t){return t!==null&&t.tagName.toLowerCase()==="textarea"},F=function(t){return typeof t>"u"||t===""?[]:Array.isArray(t)?t:t.split(" ")},fe=function(t,e){return F(t).concat(F(e))},me=function(t){return t==null},R=function(){return{listeners:[],scriptId:K("tiny-script"),scriptLoaded:!1}},he=function(){var t=R(),e=function(r,n,d,i){var l=n.createElement("script");l.referrerPolicy="origin",l.type="application/javascript",l.id=r,l.src=d;var p=function(){l.removeEventListener("load",p),i()};l.addEventListener("load",p),n.head&&n.head.appendChild(l)},s=function(r,n,d){t.scriptLoaded?d():(t.listeners.push(d),r.getElementById(t.scriptId)||e(t.scriptId,r,n,function(){t.listeners.forEach(function(i){return i()}),t.scriptLoaded=!0}))},a=function(){t=R()};return{load:s,reinitialize:a}},ve=he(),be=function(){return typeof window<"u"?window:global},b=function(){var t=be();return t&&t.tinymce?t.tinymce:null},ge={apiKey:String,licenseKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(t){return t==="html"||t==="text"}}},h=function(){return h=Object.assign||function(t){for(var e,s=1,a=arguments.length;s<a;s++){e=arguments[s];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},h.apply(this,arguments)},pe=function(t,e,s,a){return t(a||"div",{id:e,ref:s})},ye=function(t,e,s){return t("textarea",{id:e,visibility:"hidden",ref:s})},D={selector:void 0,target:void 0},Ne=W({props:ge,setup:function(t,e){var s=t.init?h(h({},t.init),D):h({},D),a=X(t),r=a.disabled,n=a.modelValue,d=a.tagName,i=Y(null),l=null,p=t.id||K("tiny-vue"),S=t.init&&t.init.inline||t.inline,x=!!e.attrs["onUpdate:modelValue"],A=!0,G=t.initialValue?t.initialValue:"",w="",q=function(c){return x?function(){return n!=null&&n.value?n.value:""}:function(){return c?G:w}},y=function(){var c=q(A),f=h(h({},s),{readonly:t.disabled,target:i.value,plugins:fe(s.plugins,t.plugins),toolbar:t.toolbar||s.toolbar,inline:S,license_key:t.licenseKey,setup:function(g){l=g,g.on("init",function(J){return ue(J,t,e,g,n,c)}),typeof s.setup=="function"&&s.setup(g)}});ce(i.value)&&(i.value.style.visibility=""),b().init(f),A=!1};V(r,function(c){var f;l!==null&&(typeof((f=l.mode)===null||f===void 0?void 0:f.set)=="function"?l.mode.set(c?"readonly":"design"):l.setMode(c?"readonly":"design"))}),V(d,function(c){var f;x||(w=l.getContent()),(f=b())===null||f===void 0||f.remove(l),L(function(){return y()})}),Z(function(){if(b()!==null)y();else if(i.value&&i.value.ownerDocument){var c=t.cloudChannel?t.cloudChannel:"7",f=t.apiKey?t.apiKey:"no-api-key",g=me(t.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(f,"/tinymce/").concat(c,"/tinymce.min.js"):t.tinymceScriptSrc;ve.load(i.value.ownerDocument,g,y)}}),$(function(){b()!==null&&b().remove(l)}),S||(ee(function(){A||y()}),te(function(){var c;x||(w=l.getContent()),(c=b())===null||c===void 0||c.remove(l)}));var Q=function(c){var f;w=l.getContent(),(f=b())===null||f===void 0||f.remove(l),s=h(h(h({},s),c),D),L(function(){return y()})};return e.expose({rerender:Q,getEditor:function(){return l}}),function(){return S?pe(I,p,i,t.tagName):ye(I,p,i)}}});const Ce={name:"NoteModal",components:{Editor:Ne},props:{show:{type:Boolean,required:!0},note:{type:Object,default:null},isEdit:{type:Boolean,default:!1}},data(){return{form:{title:"",content:"",color:"#fff8eb",isPinned:!1},loading:!1,error:null,editorConfig:{height:300,menubar:!1,plugins:"autoresize autolink lists link image charmap preview anchor searchreplace visualblocks code fullscreen insertdatetime media table paste help wordcount",toolbar:"undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }",branding:!1,language:"zh_CN"}}},computed:{modalTitle(){return this.isEdit?"编辑便签":"创建新便签"},submitButtonText(){return this.isEdit?"保存更改":"添加便签"}},created(){this.isEdit&&this.note&&(this.form={...this.note})},methods:{closeModal(){this.$emit("close")},submitForm(){if(!this.form.title.trim()){this.error="标题不能为空";return}this.loading=!0,this.error=null,this.isEdit?this.updateNote():this.addNote()},addNote(){this.$store.dispatch("addNote",this.form).then(()=>{this.$emit("note-added"),this.resetForm()}).catch(t=>{this.error="添加便签失败，请重试",console.error("添加便签失败:",t)}).finally(()=>{this.loading=!1})},updateNote(){this.$store.dispatch("updateNote",{id:this.note.id,note:this.form}).then(()=>{this.$emit("note-updated")}).catch(t=>{this.error="更新便签失败，请重试",console.error("更新便签失败:",t)}).finally(()=>{this.loading=!1})},resetForm(){this.form={title:"",content:"",color:"#fff8eb",isPinned:!1}}}},_e={class:"modal-dialog"},we={class:"modal-content"},Me={class:"modal-header"},Ee={class:"modal-title"},ke={class:"modal-body"},Se={key:0,class:"alert alert-danger"},xe={class:"mb-3"},Ae={class:"mb-3"},Pe={class:"mb-3"},De={class:"mb-3 form-check"},Ve={class:"modal-footer"},Be=["disabled"],Ie={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"};function Le(t,e,s,a,r,n){const d=C("Editor");return s.show?(u(),m("div",{key:0,class:"modal-backdrop",onClick:e[8]||(e[8]=U((...i)=>n.closeModal&&n.closeModal(...i),["self"]))},[o("div",_e,[o("div",we,[o("div",Me,[o("h5",Ee,N(n.modalTitle),1),o("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...i)=>n.closeModal&&n.closeModal(...i))})]),o("div",ke,[r.error?(u(),m("div",Se,N(r.error),1)):v("",!0),o("form",{onSubmit:e[5]||(e[5]=U((...i)=>n.submitForm&&n.submitForm(...i),["prevent"]))},[o("div",xe,[e[9]||(e[9]=o("label",{for:"title",class:"form-label"},"标题",-1)),M(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[1]||(e[1]=i=>r.form.title=i),required:""},null,512),[[B,r.form.title]])]),o("div",Ae,[e[10]||(e[10]=o("label",{for:"content",class:"form-label"},"内容",-1)),ne(d,{modelValue:r.form.content,"onUpdate:modelValue":e[2]||(e[2]=i=>r.form.content=i),init:r.editorConfig,"api-key":"9dt0c1w6azuu6pniad65dcnezwc4i75qxvp9wfrmup4t4pzh"},null,8,["modelValue","init"])]),o("div",Pe,[e[11]||(e[11]=o("label",{for:"color",class:"form-label"},"颜色",-1)),M(o("input",{type:"color",class:"form-control form-control-color",id:"color","onUpdate:modelValue":e[3]||(e[3]=i=>r.form.color=i)},null,512),[[B,r.form.color]])]),o("div",De,[M(o("input",{type:"checkbox",class:"form-check-input",id:"isPinned","onUpdate:modelValue":e[4]||(e[4]=i=>r.form.isPinned=i)},null,512),[[oe,r.form.isPinned]]),e[12]||(e[12]=o("label",{class:"form-check-label",for:"isPinned"},"置顶此便签",-1))])],32)]),o("div",Ve,[o("button",{type:"button",class:"btn btn-secondary",onClick:e[6]||(e[6]=(...i)=>n.closeModal&&n.closeModal(...i))},"取消"),o("button",{type:"button",class:"btn btn-success",onClick:e[7]||(e[7]=(...i)=>n.submitForm&&n.submitForm(...i)),disabled:r.loading},[r.loading?(u(),m("span",Ie)):v("",!0),k(" "+N(n.submitButtonText),1)],8,Be)])])])])):v("",!0)}const H=E(Ce,[["render",Le],["__scopeId","data-v-3f8e8b40"]]),Ue={name:"NoteCard",components:{NoteModal:H},props:{note:{type:Object,required:!0}},data(){return{showEditModal:!1,isExpanded:!1}},computed:{formattedDate(){return new Date(this.note.updatedAt).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},darkerColor(){return this.getDarkerColor(this.note.color)}},methods:{toggleExpand(){this.isExpanded=!this.isExpanded},openEditModal(){this.showEditModal=!0},closeEditModal(){this.showEditModal=!1},handleUpdated(){this.closeEditModal(),this.$emit("refresh")},togglePinStatus(){this.$store.dispatch("updateNote",{id:this.note.id,note:{...this.note,isPinned:!this.note.isPinned}}).then(()=>{this.$emit("refresh")}).catch(t=>{console.error("更新便签失败:",t)})},deleteNote(){confirm("确定要删除这个便签吗？此操作不可撤销。")&&this.$store.dispatch("deleteNote",this.note.id).then(()=>{this.$emit("refresh")}).catch(t=>{console.error("删除便签失败:",t)})},getDarkerColor(t){const e=t.replace("#",""),s=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16),n=30,d=Math.max(0,s-n),i=Math.max(0,a-n),l=Math.max(0,r-n);return`#${d.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}${l.toString(16).padStart(2,"0")}`}}},je={class:"col note-card-container"},ze={key:0,class:"pinned-badge"},Oe={class:"card-body d-flex flex-column"},Fe={class:"card-title"},Re={class:"note-time"},Te=["innerHTML"],Ke={key:0,class:"expand-indicator"},He={class:"note-actions mt-auto"},Ge=["title"];function qe(t,e,s,a,r,n){const d=C("NoteModal");return u(),m("div",je,[o("div",{class:"card h-100 note-card shadow-sm",style:ie({backgroundColor:s.note.color,borderTopColor:n.darkerColor})},[s.note.isPinned?(u(),m("span",ze,e[4]||(e[4]=[o("i",{class:"bi bi-pin-angle-fill"},null,-1),k(" 置顶 ")]))):v("",!0),o("div",Oe,[o("h5",Fe,N(s.note.title),1),o("p",Re,"更新于: "+N(n.formattedDate),1),o("div",{class:P(["card-text note-content",{expanded:r.isExpanded}]),onClick:e[0]||(e[0]=(...i)=>n.toggleExpand&&n.toggleExpand(...i)),innerHTML:s.note.content},null,10,Te),r.isExpanded?v("",!0):(u(),m("div",Ke,e[5]||(e[5]=[o("i",{class:"bi bi-chevron-down"},null,-1),o("span",null,"点击展开",-1)]))),o("div",He,[o("button",{class:"btn btn-sm btn-outline-primary",onClick:e[1]||(e[1]=(...i)=>n.openEditModal&&n.openEditModal(...i)),title:"编辑"},e[6]||(e[6]=[o("i",{class:"bi bi-pencil"},null,-1)])),o("button",{class:P(["btn btn-sm",s.note.isPinned?"btn-outline-warning":"btn-outline-secondary"]),onClick:e[2]||(e[2]=(...i)=>n.togglePinStatus&&n.togglePinStatus(...i)),title:s.note.isPinned?"取消置顶":"置顶"},[o("i",{class:P(["bi",s.note.isPinned?"bi-pin-angle-fill":"bi-pin-angle"])},null,2)],10,Ge),o("button",{class:"btn btn-sm btn-outline-danger",onClick:e[3]||(e[3]=(...i)=>n.deleteNote&&n.deleteNote(...i)),title:"删除"},e[7]||(e[7]=[o("i",{class:"bi bi-trash"},null,-1)]))])])],4),r.showEditModal?(u(),_(d,{key:0,show:r.showEditModal,note:s.note,isEdit:!0,onClose:n.closeEditModal,onNoteUpdated:n.handleUpdated},null,8,["show","note","onClose","onNoteUpdated"])):v("",!0)])}const Qe=E(Ue,[["render",qe],["__scopeId","data-v-4c3eb83b"]]),Je={name:"NoteList",components:{NoteCard:Qe},props:{notes:{type:Array,required:!0}},computed:{...T(["pinnedNotes","unpinnedNotes"]),hasNotes(){return this.notes&&this.notes.length>0}},methods:{refreshNotes(){this.$emit("refresh")}}},We={key:0,class:"empty-notes"},Xe={key:1},Ye={key:0,class:"mb-4"},Ze={class:"row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"},$e={key:1,class:"mt-4"},et={key:0,class:"text-muted mb-3"},tt={class:"row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"};function nt(t,e,s,a,r,n){const d=C("NoteCard");return n.hasNotes?(u(),m("div",Xe,[t.pinnedNotes.length>0?(u(),m("div",Ye,[e[1]||(e[1]=o("h6",{class:"text-muted mb-3"},[o("i",{class:"bi bi-pin-angle-fill"}),k(" 置顶便签 ")],-1)),o("div",Ze,[(u(!0),m(j,null,z(t.pinnedNotes,i=>(u(),_(d,{key:i.id,note:i,onRefresh:n.refreshNotes},null,8,["note","onRefresh"]))),128))])])):v("",!0),t.unpinnedNotes.length>0?(u(),m("div",$e,[t.pinnedNotes.length>0?(u(),m("h6",et," 其他便签 ")):v("",!0),o("div",tt,[(u(!0),m(j,null,z(t.unpinnedNotes,i=>(u(),_(d,{key:i.id,note:i,onRefresh:n.refreshNotes},null,8,["note","onRefresh"]))),128))])])):v("",!0)])):(u(),m("div",We,e[0]||(e[0]=[o("div",{class:"text-center py-5"},[o("i",{class:"bi bi-sticky fs-1"}),o("h4",{class:"mt-3"},"还没有便签"),o("p",{class:"text-muted"},"点击右下角的按钮创建你的第一个便签")],-1)])))}const ot=E(Je,[["render",nt],["__scopeId","data-v-98bd5de9"]]),it={name:"Home",components:{NoteList:ot,NoteModal:H},data(){return{searchQuery:"",showAddModal:!1,loadingNotes:!1}},computed:{...T(["notes","user"])},created(){this.fetchNotes()},methods:{fetchNotes(){this.loadingNotes=!0,this.$store.dispatch("fetchNotes").catch(t=>{console.error("获取便签失败:",t)}).finally(()=>{this.loadingNotes=!1})},searchNotes(){if(!this.searchQuery.trim()){this.fetchNotes();return}this.loadingNotes=!0,this.$store.dispatch("searchNotes",this.searchQuery).catch(t=>{console.error("搜索便签失败:",t)}).finally(()=>{this.loadingNotes=!1})},openAddModal(){this.showAddModal=!0},closeAddModal(){this.showAddModal=!1},handleNoteAdded(){this.closeAddModal(),this.fetchNotes()}}},st={class:"mb-5"},rt={class:"row justify-content-center"},lt={class:"col-md-6"},at={class:"input-group"},dt={key:0,class:"text-center my-5"};function ut(t,e,s,a,r,n){const d=C("NoteList"),i=C("NoteModal");return u(),m("div",null,[o("header",st,[o("div",rt,[o("div",lt,[o("div",at,[M(o("input",{type:"text",class:"form-control",placeholder:"搜索便签...","onUpdate:modelValue":e[0]||(e[0]=l=>r.searchQuery=l),onKeyup:e[1]||(e[1]=se((...l)=>n.searchNotes&&n.searchNotes(...l),["enter"]))},null,544),[[B,r.searchQuery]]),o("button",{class:"btn btn-success",onClick:e[2]||(e[2]=(...l)=>n.searchNotes&&n.searchNotes(...l))},e[4]||(e[4]=[o("i",{class:"bi bi-search"},null,-1),k(" 搜索 ")]))])])])]),e[7]||(e[7]=o("div",{class:"container notes-header mb-4"},[o("div",{class:"row"},[o("div",{class:"col-12"},[o("h2",{class:"border-bottom pb-2"},"我的便签")])])],-1)),r.loadingNotes?(u(),m("div",dt,e[5]||(e[5]=[o("div",{class:"spinner-border",role:"status"},[o("span",{class:"visually-hidden"},"加载中...")],-1),o("p",{class:"mt-2"},"正在加载便签...",-1)]))):(u(),_(d,{key:1,notes:t.notes,onRefresh:n.fetchNotes},null,8,["notes","onRefresh"])),o("button",{class:"floating-btn",onClick:e[3]||(e[3]=(...l)=>n.openAddModal&&n.openAddModal(...l))},e[6]||(e[6]=[o("i",{class:"bi bi-plus-lg"},null,-1)])),r.showAddModal?(u(),_(i,{key:2,show:r.showAddModal,onClose:n.closeAddModal,onNoteAdded:n.handleNoteAdded,isEdit:!1},null,8,["show","onClose","onNoteAdded"])):v("",!0)])}const mt=E(it,[["render",ut],["__scopeId","data-v-24219675"]]);export{mt as default};
